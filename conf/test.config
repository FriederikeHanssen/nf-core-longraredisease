/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for running minimal tests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

process {
    executor = 'slurm'
    clusterOptions = {
            "--account ${System.getenv("beggsa-genomicsbirmingham")} " +    
            "--qos ${task.time <= 8.h ? 'bbshort' : 'bbdefault'}"  
    }
}

executor {
    queueSize = 60            
    submitRateLimit = '1sec'  
}

params {
    // ========================================
    // MAIN ANALYSIS TOGGLES
    // ========================================
    sv                          = true       // Enable structural variant calling
    snv                         = true       // Enable SNV calling  
    cnv                         = true       // Enable CNV calling
    str                         = true       // Enable STR analysis
    phase                       = true       // Enable phasing analysis
    qc                          = true       // Enable quality control
    methyl                      = true       // Enable methylation calling
   
   
    // ========================================
    // FILTERING AND PROCESSING OPTIONS
    // ========================================
    filter_sv_coverage            = true       // Enable SV filtering by coverage
    multi_caller_sv_filtering   = true       // Enable multi-caller SV filtering
    unify_vcfs                  = true       // Enable VCF unification
    sv_caller_unify             = null
    // ========================================
    // INPUT/OUTPUT PATHS
    // ========================================
    bam_dir                     = "${projectDir}/assets/test_data/bam_pass"
    fasta_file                  = "${projectDir}/assets/test_data/genome_22/genome_22.fasta"
    bed_file                    = null
    outdir                      = './results'
    
    // ========================================
    // REFERENCE FILES
    // ========================================
    sniffles_tandem_file        = "${projectDir}/assets/data/sniffles_no_alt_analysis_set.trf.bed"
    chrom_sizes                 = "${projectDir}/assets/data/hg38.chrom.sizes"
    chromosome_codes            = [
        'chr1','chr2','chr3','chr4','chr5','chr6','chr7','chr8','chr9','chr10',
        'chr11','chr12','chr13','chr14','chr15','chr16','chr17','chr18','chr19','chr20',
        'chr21','chr22','chrX','chrY','chrMT'
    ]

    // ========================================
    // SNV CALLING PARAMETERS
    // ========================================
    use_deepvariant             = true
    clair3_model                = "r1041_e82_400bps_sup_v500"
    clair3_platform             = "ont"
    
    // ========================================
    // SV FILTERING PARAMETERS
    // ========================================
    min_read_support            = 'auto'
    min_read_support_limit      = 3
    
    // ========================================
    // MULTI-CALLER SV FILTERING PARAMETERS
    // ========================================
    max_distance_breakpoints    = 1000
    min_supporting_callers      = 2
    account_for_type            = 1
    account_for_sv_strands      = 1
    estimate_distanced_by_sv_size = 1
    min_sv_size                 = 30
    
    // ========================================
    // PHASING PARAMETERS
    // ========================================
    phase_with_sv               = true
    phase_sv_caller             = null // Will use merged if multi_caller_sv_filtering is true
    
    // ========================================
    // CNV CALLING PARAMETERS
    // ========================================
    use_qdnaseq                 = false
    genome_build                = 'hg38'
    qdnaseq_bin_size            = 1000
    method                      = 'cutoff'
    cutoff                      = 0.5
    cutoff_del                  = 0.5
    cutoff_loss                 = 1.5
    cutoff_gain                 = 2.5
    cellularity                 = 1
    
    // Spectre parameters
    spectre_mosdepth            = "${projectDir}/assets/test_data/spectre/mosdepth.regions.bed.gz"
    spectre_fasta_file          = "s3://ngi-igenomes/igenomes/Homo_sapiens/NCBI/GRCh38/Sequence/WholeGenomeFasta/genome.fa"
    spectre_snv_vcf             = "${projectDir}/assets/test_data/spectre/test_clair3_merge_output.vcf.gz"
    spectre_metadata            = "${projectDir}/assets/data/spectre_metadata.mdr"
    spectre_blacklist           = "${projectDir}/assets/data/spectre_blacklist.bed"
    
    // ========================================
    // STR ANALYSIS PARAMETERS
    // ========================================
    str_bed_file                = "${projectDir}/assets/test_data/straglr/str.test.bed"
    
    // ========================================
    // VCF UNIFICATION PARAMETERS
    // ========================================
    modify_str_calls            = true // or true if Straglr is used
    
    // ========================================
    // OUTPUT FORMAT PARAMETERS
    // ========================================
    vcf_output                  = true
    snf_output                  = true
}
