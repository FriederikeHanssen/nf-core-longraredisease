/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for running minimal tests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

process {
    resourceLimits = [       
        cpus: 1,
        memory: '2.GB'   
    ]
}

params {
    config_profile_name        = 'Test profile'
    config_profile_description = 'Minimal test dataset to check pipeline function'
    
    // iGenomes configuration for Spectre only
    igenomes_base = 's3://ngi-igenomes/igenomes'
    genome = 'GRCh38'
    
    //Test data paths 
    bam_dir      = "${projectDir}/assets/test_data/bam_pass"
    fasta_file   = "${projectDir}/assets/test_data/genome_22/genome_22.fasta"
    fai_file     = "${projectDir}/assets/test_data/genome_22/genome_22.fasta.fai" 
    
    //Assets data paths - remains the same after testing
    sniffles_tandem_file  = "${projectDir}/assets/data/sniffles_no_alt_analysis_set.trf.bed"
    bed_file      = null
    spectre_metadata = "${projectDir}/assets/data/spectre_metadata.mdr"  
    spectre_blacklist = "${projectDir}/assets/data/spectre_blacklist.bed"
    
    // SV filtering parameters
    filter_sv_calls = true
    min_read_support = 'auto'
    min_read_support_limit = 3
    chromosome_codes = [
        'chr1','chr2','chr3','chr4','chr5','chr6','chr7','chr8','chr9','chr10',
        'chr11','chr12','chr13','chr14','chr15','chr16','chr17','chr18','chr19','chr20',
        'chr21','chr22','chrX','chrY','chrMT'
    ]

    // SURVIVOR merge parameters
    merge_sv_calls  = true
    max_distance_breakpoints = 1000
    min_supporting_callers = 2
    account_for_type = 1
    account_for_sv_strands = 1
    estimate_distanced_by_sv_size = 1
    min_sv_size = 30  

    // Filtering parameters
    chrom_sizes = null
    
    // CLAIR3 configuration - all models that are available are found in teh assets/clair3_models
    clair3_model = "r1041_e82_400bps_sup_v500"
    clair3_platform = "ont"

    // DeepVariant parameters
    use_deepvariant   = true

    // Spectre configuration - can not be tested on subset of data
    spectre_fasta_file = "${params.igenomes_base}/Homo_sapiens/NCBI/GRCh38/Sequence/WholeGenomeFasta/genome.fa"
    spectre_mosdepth = "${projectDir}/assets/test_data/spectre/mosdepth.regions.bed.gz"
    spectre_snv_vcf = "${projectDir}/assets/test_data/spectre/test_clair3_merge_output.vcf.gz"
    
    // QDNAseq bin size
    use_qdnaseq                = false
    genome_build               = 'hg38'
    qdnaseq_bin_size           = 1000
    method                     = 'cutoff'
    cutoff                     = 0.5
    cutoff_del                 = 0.5
    cutoff_loss                = 1.5
    cutoff_gain                = 2.5
    cellularity                = 1

    // Str test bed file - using projectDir
    str_bed_file         = "${projectDir}/assets/test_data/straglr/str.test.bed"

    // feature flags
    phase = true
    phase_with_sv = true
    phase_sv_caller = null
    snv = true
    cnv = true
    str = true
    unify_vcfs = true // Unify SV, SNV, CNV and STR VCFs into one VCF
    
    // Output options 
    vcf_output   = true                            
    snf_output   = true
    outdir                       = './results'
}