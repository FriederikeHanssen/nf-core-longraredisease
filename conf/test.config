/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for running minimal tests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/
process {
    resourceLimits = [       
        cpus: 1,
        memory: '2.GB'   
    ]
}

params {
    // ========================================
    // MAIN ANALYSIS TOGGLES
    // ========================================
    input                       = null  // Path to sample sheet CSV file
    align_with_bam              = true      // Enable alignment
    align_with_fastq            = false     // Enable alignment with FASTQ files
    sample_name                 = 'test'     // Sample name for the analysis or patient's ID
    generate_bam_stats          = true       // Enable generation of BAM statistics
    generate_coverage           = true       // Enable generation of coverage statistics
    sv                          = true       // Enable structural variant calling
    annotate_sv                 = true       // Enable SV annotation
    snv                         = true       // Enable SNV calling  
    cnv                         = true       // Enable CNV calling
    str                         = true      // Enable STR analysis
    phase                       = true       // Enable phasing analysis
    qc                          = true      // Enable quality control
    methyl                      = true     // Enable methylation calling
    
    
    
    // ========================================
    // Consensus SV FILTERING PARAMETERS
    // ========================================
    consensuSV                 = true      // Enable multi-caller SV filtering
    max_distance_breakpoints    = 1000
    min_supporting_callers      = 2
    account_for_type            = 1
    account_for_sv_strands      = 1
    estimate_distanced_by_sv_size = 1
    min_sv_size                 = 30
    refdist                     = 100
    pctsim                      = 0.7
    pctseq                      = 0.7
    passonly                    = true
    dup_to_ins                  = false
    
    // ========================================
    // FILTERING AND PROCESSING OPTIONS
    // ========================================
    primary_sv_caller          = 'sniffles' // Primary SV caller to use (e.g. 'sniffles', 'cutesv', 'svim')
    unify_geneyx               = true    // Enable VCF unification

    
    // ========================================
    // SV FILTERING PARAMETERS
    // ========================================
    filter_sv                   = true   // Enable SV filtering by coverage
    filter_pass_sv              = true       // Filter PASS variants only in SV 
    min_read_support            = 'auto'
    min_read_support_limit      = 2

     // ========================================
     // Annotate SVs
     // ========================================
     svanna_db                = "/home/nmahfel/nf-training/svanna_db" // Path to the SvAnna database directory (e.g. "${projectDir}/assets/data/svanna_db")
     hpo_terms                = "HP:0002721;HP:0002110;HP:0500093;HP:0000717;HP:0001263;HP:0001763;HP:0003298;HP:0002857;HP:0001382"
     output_format            = "html"

    // ========================================
    // INPUT/OUTPUT PATHS
    // ========================================
    
    bam_dir                     = "${projectDir}/assets/test_data/bam_pass" // Path to the directory containing BAM files (e.g. "${projectDir}/assets/test_data/bam_pass")
    fastq_dir                   = "${projectDir}/assets/test_data/fastq_pass" // Path to the directory containing FASTQ files (e.g. "${projectDir}/assets/test_data/fastq_pass")
    // If aligned_bam is not provided, the pipeline will use the bam_dir to find BAM files.
    // If aligned_bam is provided, it will be used directly for the analysis
    // If both are provided, aligned_bam will take precedence.
    aligned_bam                 = "${projectDir}/assets/test_data/methyl_bam/test.methyl.bam"       // Path to the aligned BAM file (e.g. "${projectDir}/assets/test_data/bam_pass/test.bam"), if not provided will use the bam_dir
    fasta_file                  = "${projectDir}/assets/test_data/genome_22/genome_22.fasta"
    methyl_bam                  = "${projectDir}/assets/test_data/methyl_bam/test.methyl.bam"       // Path to the methylation BAM file  only if running from fastqs or aligned bam with methylation info
    bed_file                    = null
    outdir                      = './results'
    
    // ========================================
    // REFERENCE FILES
    // ========================================
    sniffles_tandem_file        = "${projectDir}/assets/data/sniffles_no_alt_analysis_set.trf.bed"
    chromosome_codes            = [
        'chr1','chr2','chr3','chr4','chr5','chr6','chr7','chr8','chr9','chr10',
        'chr11','chr12','chr13','chr14','chr15','chr16','chr17','chr18','chr19','chr20',
        'chr21','chr22','chrX','chrY','chrMT'
    ]

    // ========================================
    // SNV CALLING PARAMETERS
    // ========================================
    deepvariant                 = false
    merge_snv                   = false // Unify SNV VCFs from CLAIR3 and Deepvariant to upload to GeneYX
    filter_pass_snv             = false       // Filter PASS variants only in SNV 
    clair3_model                = "ont" // if this model is not found use ont. Use this model in docker r1041_e82_400bps_sup_v500
    clair3_platform             = "ont"
    
    
    // ========================================
    // PHASING PARAMETERS
    // ========================================
    phase_with_sv               = true
    
    // ========================================
    // CNV CALLING PARAMETERS
    // ========================================
    // QDNASEQ
    run_qdnaseq                 = false
    genome_build                = 'hg38'
    qdnaseq_bin_size            = 1000
    method                      = 'cutoff'
    cutoff                      = 0.5
    cutoff_del                  = 0.5
    cutoff_loss                 = 1.5
    cutoff_gain                 = 2.5
    cellularity                 = 1
    
    // Spectre parameters
    use_test_data               = true // Use test data for Spectre - can not run it in test pipeline because does not accept subset of data.
    spectre_test_mosdepth            = "${projectDir}/assets/test_data/spectre/mosdepth.regions.bed.gz"
    spectre_test_fasta_file          = "s3://ngi-igenomes/igenomes/Homo_sapiens/NCBI/GRCh38/Sequence/WholeGenomeFasta/genome.fa"
    spectre_test_clair3_vcf             = "${projectDir}/assets/test_data/spectre/test_clair3_merge_output.vcf.gz"
    spectre_metadata            = "${projectDir}/assets/data/spectre_metadata.mdr"
    spectre_blacklist           = "${projectDir}/assets/data/spectre_blacklist.bed"
    
    // ========================================
    // STR ANALYSIS PARAMETERS
    // ========================================
    str_bed_file                = "${projectDir}/assets/test_data/straglr/str.test.bed"
    
    // ========================================
    // VCF UNIFICATION PARAMETERS
    // ========================================
    modify_str_calls            = true // or true if Straglr is used
    
    // ========================================
    // OUTPUT FORMAT PARAMETERS
    // ========================================
    vcf_output                  = true
    snf_output                  = true
}
